
<SaleTabbedPanelItem>:
	on_press: print(self)
	text: "test"
	BoxLayout:
		Button
			text: "abcd"
			on_press: print(root.ids)
		TextInput:
			id: test_inputbox


<SaleTable@GridLayout>:
	canvas:
        Color:
            rgba: 0, 0, 0, 0.8
        Line:
            width: 1
            rectangle: self.x, self.y, self.width, self.height
	cols: 8
	spacing: 8
	padding: 2
	Label:
		id: item_code
		text: root.item_code or ""
		color: 0,0,0,1
		text_size: self.size
		valign: "middle"
		padding_x: 5
	TextInput:
		size_hint_x: 0.5
		id: rate
		on_text: root.cal_amt(app.root.ids.sale_screen)
		text: str(root.rate or "")
		write_tab: False
		input_filter: 'float'
	TextInput:
		id: quantity
		size_hint_x: 0.5
		text: str(root.quantity or "1")
		on_text: root.cal_amt(app.root.ids.sale_screen)
		write_tab: False
		input_filter: 'float'
	TextInput:
		id: discount_percent
		size_hint_x: 0.5
		text: str(root.discount_percent or "")
		on_text: root.cal_amt(app.root.ids.sale_screen)
		write_tab: False
		input_filter: 'float'
	TextInput:
		id: discount
		size_hint_x: 0.5
		text: str(root.discount or "")
		on_text: root.cal_amt(app.root.ids.sale_screen)
		write_tab: False
		input_filter: 'float'
	Label:
		id:amount
		color: 0,0,0,1
		size_hint_x: 0.5
		text_size: self.size
		valign: "middle"
		padding_x: 5
	Button:
		canvas:
	        Color:
	            rgba: 0, 0, 0, 0.8
	        Line:
	            width: 1
	            rectangle: self.x, self.y, self.width, self.height
		background_color: 0, 0, 0, 0
		color: 0,0,0,1
		size_hint_x: 0.5

		text: 'Remove'
		on_release: root.remove_data(app.root.ids.sale_screen)


<SalePaymentTable@GridLayout>:
	size_hint:0.9,0.9
	cols: 8
	spacing: 6
	padding: 2
	Label:
		text: str(root.p_date) or ""
		color: 0,0,0,1
		size_hint_x: 0.6
		text_size: self.size
		valign: "middle"
	Label:
		id: rate
		text: str(root.p_time) or ""
		color: 0,0,0,1
		size_hint_x: 0.6
		text_size: self.size
		valign: "middle"
	Label:
		text: str(root.transaction_ref) or ""
		color: 0,0,0,1
		text_size: self.size
		valign: "middle"
		size_hint_x: 0.8
	Label:
		text: str(root.payment_type) or ""
		color: 0,0,0,1
		size_hint_x: 0.6
		text_size: self.size
		valign: "middle"
	Label:
		text: str(root.mode_of_payment) or ""
		color: 0,0,0,1
		size_hint_x: 0.6
		text_size: self.size
		valign: "middle"
	Label:
		text: str(root.card_four_digits) or ""
		color: 0,0,0,1
		size_hint_x: 0.6
		text_size: self.size
		valign: "middle"
	Label:
		text: str(root.amount) or ""
		color: 0,0,0,1	
		size_hint_x: 0.6
		text_size: self.size
		valign: "middle"
	Button:
		canvas:
	        Color:
	            rgba: 0, 0, 0, 0.8
	        Line:
	            width: 1
	            rectangle: self.x, self.y, self.width, self.height
		background_color: 0, 0, 0, 0
		color: 0,0,0,1
		size_hint_x: 0.6

		text: 'Remove'
		on_release: root.remove_data()



<SaleGrid@GridLayout>:
	size_hint: 1.2,1.2
	size_hint_y: 0.6
	cols:6
	CustomGridButton:
		text: root.customer or ""
	    on_press: root.line_click()
	CustomGridButton:
		text: root.invoice_date or ""
	CustomGridButton:
		text: root.subtotal or ""
	CustomGridButton:
		text: root.discount or ""
	CustomGridButton:
		text: root.taxes or ""
	CustomGridButton:
		text: root.total or ""
	

<SaleList>
	sallist: sallist
	canvas:
		Color:
		    rgba: (1,1,1,1) 
		Rectangle:
		    pos: self.pos
		    size: self.size
	CustomBoxLayout:
		padding: 20
		orientation: "vertical"
		BoxLayout:
			orientation: "vertical"
			BoxLayout:
				spacing: 5
				size_hint_y: 0.06
				CustomListTitle:
					text: "Sale"
					size_hint_x: 0.5
				Label:
					text: "Search By Customer"
					size_hint_x: 0.2
					color: 0,0,0,1
				TextInput:
					id: selected_customer
					size_hint_y: 0.8
					size_hint_x: 0.3
					on_text: root.on_customer_input_for_search()
				Label:
					text: "Search By Date"
					size_hint_x: 0.2
					color: 0,0,0,1
				DatePicker:	
					id: selected_date
					pHint: 0.2,0.3
					font_size: 15
					text_size: self.size
					size_hint_y: 0.8
					size_hint_x: 0.13
					on_text: root.on_search_date()
					text: ""
				BoxLayout:
					size_hint_x: 0.1
				CustomListButton:
					text: "Back"
					size_hint_x: 0.15
					on_press:
						root.manager.current= 'main_page'
						root.manager.transition = SlideTransition(direction="right")
				CustomListButton:
					text: "Add New"
					size_hint_x: 0.15
					on_press: 
						root.make_current_click_idx_null()
						root.manager.current= 'sale'
						root.manager.transition = SlideTransition(direction="left")
					
			BoxLayout:
				size_hint_y: 0.1
				CustomListLabel:
					text: "Customer Name"				
				CustomListLabel:
					text: "Date"
				CustomListLabel:
					text: "Sub Total"
				CustomListLabel:
					text: "Discount"
				CustomListLabel:
					text: "Tax"
				CustomListLabel:
					text: "Total"
				
			CustomListBoxLayout:
				RecycleView:
					scroll_type:['bars', 'content']
					bar_width: 10
					bar_color: (0,0,0,0.2)
					canvas.after:
				        Color:
				            rgba: self.bar_color[:3] + [self.bar_color[3] * 1 if self.do_scroll_y else 0]
				        Rectangle:
				            pos: self.right - self.bar_width - self.bar_margin, self.y + self.height * self.vbar[0]
				            size: self.bar_width, self.height * self.vbar[1]
					id: sallist
					viewclass: 'SaleGrid'
					CustomListRecycleGridLayout:
<Sale>:
	canvas:
		Color:
		    rgba: (1,1,1,1) 
		Rectangle:
		    pos: self.pos
		    size: self.size

	CustomBoxLayout:
		orientation: "horizontal"
		padding: 20 
		spacing: 20
		BoxLayout:
			orientation: "vertical"
		    BoxLayout:
				size_hint_y: 0.05
				CustomBackButton:
					size_hint_x: 0.15
					size_hint_y: 1.3
					bold: True
					on_press: 
						app.root.ids.sale_list_screen.make_current_click_idx_null()
						root.manager.current= 'sale_list'	
						root.manager.transition = SlideTransition(direction="right")

				Label:
				Button:
					text: '+'
					size_hint_x: 0.15
					size_hint_y: 1.3
					on_press: root.add_panel()
			BoxLayout:
				size_hint_y: 0.03
			SaleTab:
				#id: saletab
				do_default_tab: False
		        background_color: (0,0,0,0.1)    # White colour
		        border: [0, 0, 0, 0]
		        tab_width: self.parent.width / 12
		        TabbedPanelItem:
		        	background_color: (0,0,0,0.1)
		        	color: (0,0,0,2)
		        	canvas:
				        Color:
				            rgba: 0, 0, 0, 1
				        Line:
				            width: 1
				            rectangle: self.x, self.y, self.width, self.height
        		    text: 'Screen1'
					CustomLineBoxLayout:
						canvas:
							Color:
							    rgba: (1,1,1,1) 
							Rectangle:
							    pos: self.pos
							    size: self.size
						orientation: "vertical"
						ScrollView:
							scroll_type:['bars', 'content']
							bar_width: 10
							bar_color: (0,0,0,0.2)
							canvas.after:
						        Color:
						            rgba: self.bar_color[:3] + [self.bar_color[3] * 1 if self.do_scroll_y else 0]
						        Rectangle:
						            pos: self.right - self.bar_width - self.bar_margin, self.y + self.height * self.vbar[0]
						            size: self.bar_width, self.height * self.vbar[1]
							GridLayout:
								canvas:
									Color:
									    rgba: (0,0,0,0.05) 
									Rectangle:
									    pos: self.pos
									    size: self.size
						        cols: 1
						        size_hint_y: 1.5
						        height: self.minimum_height
								BoxLayout:
									padding: 20
									size_hint_y: 0.08
								    Label:
										size_hint_y: 3
										size_hint_x: 0.2
								        font_size: 30
								        text: "Sale"
								        text_size: self.size
								        bold: True
								        italic: True
								        color: 0,0,0,1

								BoxLayout:
									padding: 20
									orientation: "vertical"
								    BoxLayout:
								    	size_hint_y: 0.02
										Label:
											size_hint_y: 3
											size_hint_x: 0.05
									        font_size: 20
									        text: "Date:"
									        text_size: self.size
									        bold: True
									        color: 0,0,0,1
									    DatePicker:					
											pHint: 0.2,0.3
											font_size: 15
											text_size: self.size
											size_hint_y: 4
											size_hint_x: 0.08
									    	id: invoice_date
									    BoxLayout:
									    	size_hint_x: 0.3
									    Label:
											size_hint_y: 3.5
											size_hint_x: 0.05
									        font_size: 20
									        text: "Time:"
									        text_size: self.size
									        bold: True
									        color: 0,0,0,1
									    Label:
											size_hint_y: 3
											size_hint_x: 0.2
									        font_size: 20
									        id: invoice_time
									        text: root.invoice_time or "" 
									        text_size: self.size
									        bold: True
									        color: 0,0,0,1
									BoxLayout:
										size_hint_y: 0.15
										Label:
											size_hint_y: 0.50
											size_hint_x: 1
									        font_size: 20
									        text: "Customer"
									        padding_x: 90
									        text_size: self.size
									        bold: True
									        color: 0,0,0,1
									    TextInput:
											id: customer_name
											text: str(root.customer_name) or ""
											size_hint_y: 0.70
									    	font_size: 17
									    	on_text: root.on_customer_input()
									    	on_focus: root.on_focus(self.text)
									    BoxLayout:
									BoxLayout:
										size_hint_y: 0.15
										Label:
											size_hint_y: 0.50
											size_hint_x: 1
									        font_size: 20
									        text: "Item"
									        padding_x: 90
									        text_size: self.size
									        bold: True
									        color: 0,0,0,1
										TextInput:
											id: item_code
											text: str(root.item_code) or ""
											size_hint_y: 0.70
									    	font_size: 17
									    	on_text: root.on_item_input()
									    BoxLayout:
									BoxLayout:
										size_hint_y: 0.1
									BoxLayout:
										size_hint_y: 0.05
										CustomHeadingLabel:
											text: 'Item Code '
											font_size: 15
											color: 0,0,0,1
											bold: True
											size_hint_x: 1.9
										CustomHeadingLabel:
											text: "Rate"
											size_hint_x: 1
										CustomHeadingLabel:
											text: "Qty"
											
										CustomHeadingLabel:
											text: 'Discount%'
											
										CustomHeadingLabel:
											text: "Discount"
											
										CustomHeadingLabel:
											text: 'Amount'
											
										CustomHeadingLabel:
											
									BoxLayout:
										canvas:
									        Color:
									            rgba: 0, 0, 0, 0.8
									        Line:
									            width: 1
									            rectangle: self.x, self.y, self.width, self.height
									
											Color:
											    rgba: (1,1,1,1) 
											Rectangle:
											    pos: self.pos
											    size: self.size
										size_hint_y: 0.7
										RecycleView:
											id: sales_invoice_items
											viewclass: 'SaleTable'
											RecycleGridLayout:
								                cols: 1
								                key_selection: 'selectable'
								                default_size: None, dp(35)
								                default_size_hint: 1, None
								                size_hint_y: None
								                height: self.minimum_height
								                multiselect: True
								                touch_multiselect: True
								    BoxLayout:
										size_hint_y: 0.05
									BoxLayout:
										size_hint_y: 0.35
										BoxLayout:
											size_hint_x: 1.2
										BoxLayout:
											BoxLayout:
												orientation: "vertical"
												Label:
													text: 'Sub Total'
													font_size: 15
													color: 0,0,0,1
													bold: True
													text_size: self.size
													size_hint_y: 0.05
												Label:
													text: 'Disc.'
													font_size: 15
													color: 0,0,0,1
													bold: True
													text_size: self.size
													size_hint_y: 0.1
												Label:
													text: 'Tax'
													font_size: 15
													color: 0,0,0,1
													bold: True
													text_size: self.size
													size_hint_y: 0.1
												Label:
													text: "Total"
													font_size: 15
													color: 0,0,0,1
													bold: True
													text_size: self.size
													size_hint_y: 0.1
												
											BoxLayout:
												orientation: "vertical"
												Label:
													id: subtotal
													font_size: 15
													color: 0,0,0,1
													bold: True
													text_size: self.size
													size_hint_y: 0.07
												Label:
													size_hint_y: 0.04
												TextInput:
													id: discount
													font_size: 15
													text_size: self.size
													on_text: root.cal_tot()
													input_filter: 'float'
													size_hint_y: 0.1
													size_hint_x: 0.4
												Label:
													id: taxes
													font_size: 15
													color: 0,0,0,1
													bold: True
													text_size: self.size
													size_hint_y: 0.1
												Label:
													id: total
													font_size: 15
													color: 0,0,0,1
													bold: True
													text_size: self.size
													size_hint_y: 0.1

									BoxLayout:
										size_hint_y: 0.2
										Button:
											canvas:
										        Color:
										            rgba: 0, 0, 0, 0.8
										        Line:
										            width: 1
										            rectangle: self.x, self.y, self.width, self.height
					    					background_color: 0, 0, 0, 0.1
					    					color: 0,0,0,1
						            		size_hint_y: 0.6
						            		bold: True
											text: "Make Payment"
											on_release: Factory.SalePaymentPopup(root).open()
										Label:
											size_hint_x: 7
									BoxLayout:
										size_hint_y: 0.05
									BoxLayout:
										size_hint_y: 0.05
										CustomHeadingLabel:
											text: 'Pay Date'
											size_hint_x: 0.6
										CustomHeadingLabel:
											text: "Pay Time"
											size_hint_x: 0.6
										CustomHeadingLabel:
											text: "Tran Ref."
											size_hint_x: 0.8
											
										CustomHeadingLabel:
											text: 'Pay Type'
											size_hint_x: 0.6
										CustomHeadingLabel:
											text: "Mode of Pay"
											size_hint_x: 0.6
										CustomHeadingLabel:
											text: 'Card No.'
											size_hint_x: 0.6
										CustomHeadingLabel:
											text: 'Amount'
											size_hint_x: 0.6
										CustomHeadingLabel:
											size_hint_x: 0.6
									BoxLayout:
										canvas:
									        Color:
									            rgba: 0, 0, 0, 0.8
									        Line:
									            width: 1
									            rectangle: self.x, self.y, self.width, self.height
									
											Color:
											    rgba: (1,1,1,1) 
											Rectangle:
											    pos: self.pos
											    size: self.size
										size_hint_y: 0.3
										RecycleView:
											id: payments
											viewclass: 'SalePaymentTable'
											RecycleGridLayout:
								                cols: 1
								                key_selection: 'selectable'
								                default_size: None, dp(35)
								                default_size_hint: 1, None
								                size_hint_y: None
								                height: self.minimum_height
								                multiselect: True
								                touch_multiselect: True

									BoxLayout:
										size_hint_y: 0.1			
									BoxLayout:
										size_hint_y: 0.15
										BoxLayout:
											size_hint_x: 1.5
										Button:
											canvas:
										        Color:
										            rgba: 0, 0, 0, 0.8
										        Line:
										            width: 1
										            rectangle: self.x, self.y, self.width, self.height
					    					background_color: 0, 0, 0, 0.1
					    					color: 0,0,0,1
						            		text: "Submit"
						            		size_hint_y: 0.8
						            		bold: True
						            		on_press: root.save()
						            	BoxLayout:
						            	BoxLayout:
							            	CustomCancelButton:
							            		size_hint_y: 0.8
							            		on_press: root.cancel()
						            	BoxLayout:
						            		size_hint_x: 1.5

				

		BoxLayout:
        	size_hint_x: 0.5
        	

<SalePaymentPopup@Popup>:
	title: 'Payment'
    size_hint: (None, None)
    size: (600, 600)
    auto_dismiss: False